<!DOCTYPE html>
<html>
<head>
	
	<title>Budget Map</title>

	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="css/style.css">
    
    <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v0.48.0/mapbox-gl.js'></script>
    <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v0.48.0/mapbox-gl.css' rel='stylesheet' />

    <link href="https://fonts.googleapis.com/css?family=Baloo+Tammudu|Raleway|Titillium+Web|Caveat" rel="stylesheet">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.3.1/css/all.css">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.3.1/css/v4-shims.css">
</head>
<body>
    <h1>
        <i class="fa fa-plane" style="font: size 24px;"></i>
        &nbsp Trip to Lisbon 2018
    </h1>

    <div id="map" style="max-width: 700px; height: 450px; margin:0 auto;"></div>
    <script type="text/javascript" src="js/script.js"> </script>
    <script>
        mapboxgl.accessToken = 'pk.eyJ1Ijoib2h5ZWFoYnJhdm8iLCJhIjoiY2psbXNqZmc0MTdhcDNycGIyenp6YTM5dSJ9.Zo0fukXCo-JW__NFIBQ7rw';
       
        var map = new mapboxgl.Map({
            container: 'map', // container id
            style: 'mapbox://styles/mapbox/light-v9',
            center: [-9.138307571411133, 38.71518391681351], // starting position
            zoom: 13 // starting zoom
        });

        // Add zoom and rotation controls to the map.
        var nav = new mapboxgl.NavigationControl();
        map.addControl(nav, 'bottom-right');
        
        // Add Points
        map.on('load', function() {
            map.addSource("lisbon18", {
                "type": "geojson",
                "data": "https://dl.dropbox.com/s/axgc96qdg5g6rvp/lisbon18.geojson?dl=0"
            });
            
            map.addLayer({
                'id':'points',
                'type': 'circle',
                'source': "lisbon18",
                'paint': {
                    'circle-stroke-width': 1,
                    'circle-stroke-color': '#fff',
                    // circles change size as zoom level
                    'circle-radius': {
                        'base': 1.7,
                        'stops': [[5, 3], [22, 160]]
                    },

                    // circles are colored according to the categories
                    'circle-color': [
                        'match',
                        ['get', 'Category'],
                        'Transportation', '#0074D9', // blue
                        'Accommodation', '#4ABDAC',  // green
                        'Food', '#F7B733',   // yellow
                        'Sightseeing', '#FC4A1A',    // red
                        /* other */ '#DFDCE3'    // grey
                    ]
                }
            });
        });
        
        // add info box
        // https://www.mapbox.com/help/gl-dds-map-tutorial/#result-3
        map.on('click', function(e) {
            var features = map.queryRenderedFeatures(e.point, { layers: ['points'] });    
            
            if (!features.length) {
                return;
            }

            var feature = features[0];
            
            var payment = "fas fa-strikethrough"
            if(feature.properties['Payment'] == "Card")
                payment = "fas fa-credit-card"
            else if(feature.properties['Payment'] == "Cash")
                payment = "fas fa-money-bill"


            var popup = new mapboxgl.Popup()
            .setLngLat(feature.geometry.coordinates)
            .setHTML(
                '<div id=\'popup\' class=\'popup\' style=\'z-index: 10;\'>'
                    + '<h5>' + feature.properties['Title'] + '</h5>'
                    + '<h6>' 
                        + '<i class="fas fa-euro-sign" style="font: size 10px;"></i>' + '&nbsp&nbsp' + feature.properties['Amount'] + '&nbsp&nbsp&nbsp'
                        + '<i class="' + payment + '" style="font: size 12px; color: #C5C6F3;"></i>' + '</br>'
                        + '<i class="fas fa-map-marker-alt" style="font: size 10px;"></i>' + '&nbsp&nbsp' + feature.properties['Location'] + '<br>'
                        + '<i class="fas fa-clock" style="font: size 10px;"></i>' + '&nbsp&nbsp' + feature.properties['Date'] + '<br>'
                    + '</h6>'
                    + '<div class="memo">' + feature.properties['Memo'] + '</div>'
                + '</div>'
            ).addTo(map);
        });

        // change cursor when you hover over the point
        map.on('mousemove', function(e) {
            var features = map.queryRenderedFeatures(e.point, { layers: ['points'] });
            map.getCanvas().style.cursor = features.length ? 'pointer' : '';
        });
        
    </script>
    </body>
    </html>
